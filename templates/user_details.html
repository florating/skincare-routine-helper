{% extends "base.html" %}

{% block title %}
  {{ current_user.f_name }}'s Profile
{% endblock title %}

{% block head %}{% endblock %}

{% block body %}
<div class="container">
  <div class="row">
    <div id="user_info" col="col-lg-5 offset-lg-1">
      <h1>My Profile</h1>
        {% if current_user.is_authenticated %}
          <table>
            {% for param_key in current_user.__table__.columns.keys() %}
            <tr>
                {# do not display sensitive information! #}
                <td>{{ param_key }}</td>
                <td>{{ current_user[param_key] if param_key not in ["hashed_password"] else "hidden" }}</td>
            </tr>
            {% endfor %}
          </table>
        {% else %}
          Please login <a href="/login">here</a>.
        {% endif %}
        <p class='settings'><i><a href="/settings">Click here</a> to update your user profile or settings.</i></p>
    </div>
    <div id="user_cabinet" col="col-lg-5">
        <h3>My Cabinet</h3>
        {% if current_user.cabinets %}
        
        <!-- {% for obj in current_user.cabinets %}
          <li>obj.product = {{ obj.product }}</li>
        {% endfor %} -->
        <!-- My Cabinet -->

        <table class="cabinet-list">
          <tr>
            <td>--</td>
            <td><b>Product</b></td>
            <td><b>Product Type</b></td>
            <!-- <td>Product Image</td> -->
          </tr>
          {% for obj in current_user.cabinets %}
            <tr>
              <td>
                Check
                {# FIXME #}
              </td>
              <td>
                <a href="/products/{{ obj['product_id'] }}" target="_blank">
                  {{ obj.product.product_name }}
                </a>
              </td>
              <td>
                {{ obj.product['category']['category_name'] }}
              </td>
              <!-- <td>
                <img id="product_id_{{ obj['product_id'] }}" src="">
              </td> -->
            </tr>
          {% endfor %}
        </table>

        {% else %}
          <p>You don't have anything in your cabinet yet! <a href="/products/search">Click here</a> to search for a skincare product.</p>
        {% endif %}
    </div>
  </div>

  <div class="row">
    <div class="routine col-5" id="user_am_routine">
      <h3>My AM Routine</h3>
      <!-- My AM Routine -->
      {% if current_user.am_routines %}
        <ul>
          {% for obj in current_user.am_routines %}
            <li>obj.product_id = {{ obj.product_id }}</li>
            <li>crud.get_obj_by_id('Product', obj.product_id).product_name = {{ crud.get_obj_by_id('Product', obj.product_id).product_name }}</li>
          {% endfor %}
        </ul>
      {% else %}
        <p>You don't have anything in your routine yet!
          {% if not current_user.cabinets %}
            Add something to your cabinet first, and then add products from your cabinet into your skincare routine!
          {% else %}
            <a href="/routine">Click here</a> to add something from your cabinet to your skincare routine! (Currently under construction!)
          {% endif %}
        </p>
      {% endif %}
    </div>
    <div class="routine col-5 offset-1" id="user_pm_routine">
      <h3>My PM Routine</h3>
      <!-- My PM Routine -->
      {% if current_user.pm_routines %}
        <ul>
          {% for obj in current_user.pm_routines %}
            <li>obj.product_id = {{ obj.product_id }}</li>
            <li>crud.get_obj_by_id('Product', obj.product_id).product_name = {{ crud.get_obj_by_id('Product', obj.product_id).product_name }}</li>
          {% endfor %}
        </ul>
      {% else %}
        <p>You don't have anything in your routine yet!
          {% if not current_user.cabinets %}
            Add something to your cabinet first, and then add products from your cabinet into your skincare routine!
          {% else %}
            <a href="/routine">Click here</a> to add something from your cabinet to your skincare routine! (Currently under construction!)
          {% endif %}
        </p>
      {% endif %}
    </div>
  </div>
  <div class="offset-3 col-5 search" id="search_for_product">
      <h2>Search for a Product!</h2>
      <form action="/products/search" methods="POST">
      <input
        type="text"
        name="product_name"
        placeholder="Product Name"
        title="Leave this blank to get all products!"
      />
      <input
        type="text"
        name="product_type"
        placeholder="Product Type"
      />
      {# comment #}
      <!-- FIXME: change product_type to something else once model.py for User is fixed, maybe use dropdown menu -->
      <input type="submit" value="Go!">
  </form>
  <div id="search_results"></div>
  </div>
</div>
{% endblock body %}

{% block after_body %}
<!-- <script type="text/jsx" src="/static/routines.jsx"></script> -->
{% endblock %}
